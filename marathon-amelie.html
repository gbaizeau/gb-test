<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amélie's 12-Week Marathon Training Dashboard (4h00 Goal)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Slate & Teal -->
    <!-- Application Structure Plan: A dashboard layout is used to provide an at-a-glance overview. The left column contains key stats (countdown, paces) and a visual chart of weekly effort, providing constant context. The main right column dynamically displays the training plan, defaulting to "This Week's" workouts for immediate relevance. This structure was chosen to transform the static plan into an active, daily tool. Users can easily see what they need to do today, track their progress visually, and switch to the full plan for future planning, making the information highly consumable and user-friendly. -->
    <!-- Visualization & Content Choices: Weekly KM (Report Info) -> Goal: Visualize training load -> Viz: Bar Chart (Chart.js) -> Interaction: Hover for details -> Justification: Clearly shows workload progression and taper. | Training Schedule (Report Info) -> Goal: Present daily workouts clearly -> Viz: Interactive HTML Table -> Interaction: JS highlights current week, checkboxes mark completion, input fields for actuals -> Justification: Makes the plan an active tracking and logging tool. | Race Date (Report Info) -> Goal: Build motivation -> Viz: Countdown Timer -> Interaction: None -> Justification: Creates a sense of urgency and excitement. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
                max-height: 350px;
            }
        }
        .table-cell-top { vertical-align: top; }
        .completed-run label:first-of-type { /* Targets the planned workout label */
            text-decoration: line-through;
            opacity: 0.6;
        }
        .motivational-text {
            font-style: italic;
            color: #0d9488; /* teal-600 */
            padding-top: 4px;
            padding-bottom: 8px;
        }
        .input-sm {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid #cbd5e1; /* slate-300 */
        }
        .weekly-summary-row td {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            font-weight: 600;
            background-color: #f8fafc; /* slate-50 */
        }
        .pace-greyed {
            color: #94a3b8; /* slate-400 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Amélie's Marathon Training Dashboard</h1>
            <p class="text-lg text-slate-600 mt-1">Queenstown Marathon - 4h00 Goal</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <aside class="lg:col-span-1 space-y-8">
                
                <section class="bg-white p-6 rounded-2xl shadow-sm">
                    <h2 class="text-xl font-bold text-slate-900 mb-3">Race Day Countdown</h2>
                    <p class="text-slate-600 mb-2">For Queenstown Marathon: <strong class="text-teal-600">November 15th, 2025</strong></p>
                    <p class="text-slate-600 mb-4">This timer shows how long until race day. Use it as motivation to stay consistent!</p>
                    <div id="countdown" class="flex justify-center space-x-2 sm:space-x-4 text-center bg-slate-100 p-4 rounded-lg">
                        <div><span id="days" class="text-2xl sm:text-4xl font-bold text-teal-600">--</span><p class="text-xs text-slate-500">Days</p></div>
                        <div><span id="hours" class="text-2xl sm:text-4xl font-bold text-teal-600">--</span><p class="text-xs text-slate-500">Hours</p></div>
                        <div><span id="minutes" class="text-2xl sm:text-4xl font-bold text-teal-600">--</span><p class="text-xs text-slate-500">Minutes</p></div>
                        <div><span id="seconds" class="text-2xl sm:text-4xl font-bold text-teal-600">--</span><p class="text-xs text-slate-500">Seconds</p></div>
                    </div>
                </section>

                <section class="bg-white p-6 rounded-2xl shadow-sm">
                    <h2 class="text-xl font-bold text-slate-900 mb-3">Weekly Volume</h2>
                    <p class="text-slate-600 mb-4">This chart visualizes your planned total kilometers each week. It helps you see the training build-up and the taper period before the race.</p>
                    <div class="chart-container">
                        <canvas id="mileageChart"></canvas>
                    </div>
                </section>

                <section class="bg-white p-6 rounded-2xl shadow-sm">
                    <h2 class="text-xl font-bold text-slate-900 mb-3">Pace Guide</h2>
                    <p class="text-slate-600 mb-4">Refer to this guide for your target paces during different types of workouts. Nailing these paces is key to achieving your 4-hour goal.</p>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between p-2 rounded bg-slate-50"><span>Easy Run (ER)</span><span class="font-semibold">6:15-7:00 /km</span></div>
                        <div class="flex justify-between p-2 rounded bg-slate-50"><span>Long Run (LR)</span><span class="font-semibold">6:10-6:30 /km</span></div>
                        <div class="flex justify-between p-2 rounded bg-slate-50"><span>Marathon Pace (MP)</span><span class="font-semibold text-teal-600">~5:41 /km</span></div>
                        <div class="flex justify-between p-2 rounded bg-slate-50"><span>Tempo Run (TR)</span><span class="font-semibold">5:15-5:25 /km</span></div>
                        <div class="flex justify-between p-2 rounded bg-slate-50"><span>Intervals (1k)</span><span class="font-semibold">5:00-5:10 /km</span></div>
                    </div>
                </section>

            </aside>

            <div class="lg:col-span-2">
                <section class="bg-white p-6 rounded-2xl shadow-sm">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4">
                        <h2 class="text-xl font-bold text-slate-900 mb-2 sm:mb-0">Training Schedule</h2>
                        <div class="flex space-x-2">
                            <button id="view-week-btn" class="bg-teal-600 text-white py-2 px-4 rounded-lg font-semibold text-sm shadow-sm hover:bg-teal-700 transition-colors">This Week</button>
                            <button id="view-full-btn" class="bg-slate-200 text-slate-800 py-2 px-4 rounded-lg font-semibold text-sm hover:bg-slate-300 transition-colors">Full Plan</button>
                        </div>
                    </div>
                    <p id="plan-intro" class="text-slate-600 mb-6">This section shows your training plan. By default, you'll see the current week's workouts. Use the buttons to toggle between this week and the full 12-week schedule. Check off runs as you complete them and log your actuals.</p>
                    <div id="plan-container" class="overflow-x-auto">
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const planStartDate = new Date("2025-08-26T00:00:00"); 
        const raceDate = new Date("2025-11-15T08:00:00");
        const localStorageKey = 'completedRuns_Amelie_4h00_v2';

        const trainingPlanData = [
            { week: 1, dates: "Aug 26 - Sep 1", totalKm: 32, mon: "Rest", tue: "ER 8km + 4 Strides", wed: "Rest or XT", thu: "TR: 2km WU, 4km @ Tempo (5:15-5:25/km), 2km CD (8km total)", fri: "Rest", sat: "LR 16km", sun: "Rest or RR 3-5km", motivation: "Great start! Consistency is your superpower." },
            { week: 2, dates: "Sep 2 - Sep 8", totalKm: 39, mon: "Rest", tue: "ER 10km", wed: "Rest or XT", thu: "IT: 2km WU, 6x800m @ ~3:52-4:00 (400m jog recovery), 2km CD (approx 11km total)", fri: "Rest", sat: "LR 18km", sun: "Rest or RR 3-5km", motivation: "Building that base. Every km counts!" },
            { week: 3, dates: "Sep 9 - Sep 15", totalKm: 44, mon: "Rest", tue: "ER 10km + 4 Strides", wed: "Rest or XT", thu: "MP Run: 2km WU, 8km @ MP (5:41/km), 2km CD (12km total)", fri: "Rest", sat: "LR 22km", sun: "Rest or RR 3-5km", motivation: "First taste of Marathon Pace. You got this!" },
            { week: 4, dates: "Sep 16 - Sep 22", totalKm: 37, mon: "Rest", tue: "ER 8km", wed: "Rest or XT", thu: "TR: 2km WU, 5km @ Tempo (5:15-5:25/km), 2km CD (9km total)", fri: "Rest", sat: "LR 20km", sun: "Rest or RR 3-5km", motivation: "Solid week. Recover well, you're earning it." },
            { week: 5, dates: "Sep 23 - Sep 29", totalKm: 49, mon: "Rest", tue: "IT: 2km WU, 5x1km @ ~5:00-5:10/km (400m jog recovery), 2km CD (approx 11km total)", wed: "Rest or XT or RR 5km", thu: "ER 12km + 4 Strides", fri: "Rest", sat: "LR 26km", sun: "Rest", motivation: "Stepping up the intensity. Feel that strength!" },
            { week: 6, dates: "Sep 30 - Oct 6", totalKm: 54, mon: "Rest", tue: "ER 10km", wed: "Rest or XT", thu: "MP Run: 2km WU, 10km @ MP (5:41/km), 2km CD (14km total)", fri: "Rest", sat: "LR 30km", sun: "Rest or RR 5km", motivation: "30km! Huge milestone. Believe in your progress." },
            { week: 7, dates: "Oct 7 - Oct 13", totalKm: 46, mon: "Rest", tue: "TR: 2km WU, 6km @ Tempo (5:15-5:25/km), 2km CD (10km total)", wed: "Rest or XT or RR 5km", thu: "ER 12km + 4 Strides", fri: "Rest", sat: "LR 24km (include 6-8km @ MP mid-run)", sun: "Rest", motivation: "Mixing it up. Stay focused and trust the process." },
            { week: 8, dates: "Oct 14 - Oct 20", totalKm: 54, mon: "Rest", tue: "IT: 7-8x800m @ ~3:52-4:00 (400m jog recovery), 2km CD (approx 11-12km total)", wed: "Rest or XT or RR 5km", thu: "ER 10km", fri: "Rest", sat: "LR 32km", sun: "Rest", motivation: "Longest run done! You're so ready for this." },
            { week: 9, dates: "Oct 21 - Oct 27", totalKm: 38, mon: "Rest", tue: "ER 8km", wed: "Rest or XT", thu: "MP Run: 2km WU, 6km @ MP (5:41/km), 2km CD (10km total)", fri: "Rest", sat: "LR 20km", sun: "Rest or RR 3-5km", motivation: "Taper time. Let your body absorb all that hard work." },
            { week: 10, dates: "Oct 28 - Nov 3", totalKm: 32, mon: "Rest", tue: "IT: 2km WU, 4x800m @ ~3:52-4:00 (400m jog recovery), 2km CD (approx 8km total)", wed: "Rest or XT or RR 3km", thu: "ER 8km + 4 Strides", fri: "Rest", sat: "LR 16km", sun: "Rest", motivation: "Stay sharp, stay rested. Nearly there!" },
            { week: 11, dates: "Nov 4 - Nov 10", totalKm: 21, mon: "Rest", tue: "ER 6km + 4 Strides", wed: "Rest or XT", thu: "ER 5km", fri: "Rest", sat: "LR 10km (very easy)", sun: "Rest", motivation: "Almost there. Visualize crossing that finish line!" },
            { week: 12, dates: "Nov 11 - Nov 15", totalKm: 12, mon: "Rest/3k shakeout", tue: "ER 4-5km + strides", wed: "Rest", thu: "ER 2-3km", fri: "Rest", sat: "RACE DAY! 🏁", sun: "", motivation: "Race week! Enjoy every moment. You've earned this!" }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            const planContainer = document.getElementById('plan-container');
            const viewWeekBtn = document.getElementById('view-week-btn');
            const viewFullBtn = document.getElementById('view-full-btn');
            const planIntro = document.getElementById('plan-intro');
            
            let runLogData = JSON.parse(localStorage.getItem(localStorageKey)) || {};
            
            function saveRunLogData() {
                localStorage.setItem(localStorageKey, JSON.stringify(runLogData));
            }

            function getWeekNumber(currentDate, pStartDate) {
                const msPerDay = 1000 * 60 * 60 * 24;
                const daysSinceStart = Math.floor((currentDate - pStartDate) / msPerDay);
                if (daysSinceStart < 0) return 1;
                const weekNum = Math.floor(daysSinceStart / 7) + 1;
                return weekNum > 12 ? 12 : weekNum;
            }

            const currentWeekNumberGlobal = getWeekNumber(new Date(), planStartDate);

            function getFormattedDate(baseDate, dayOffset) {
                const targetDate = new Date(baseDate);
                targetDate.setDate(targetDate.getDate() + dayOffset);
                return targetDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            }

            function parseTimeToSeconds(timeStr) {
                if (!timeStr || !/^\d{1,2}:\d{2}:\d{2}$/.test(timeStr)) return 0;
                const parts = timeStr.split(':').map(Number);
                return parts[0] * 3600 + parts[1] * 60 + parts[2];
            }

            function formatSecondsToHHMMSS(totalSeconds) {
                if (isNaN(totalSeconds) || totalSeconds === 0) return "00:00:00";
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = Math.floor(totalSeconds % 60);
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            function calculatePace(timeStr, distanceKm) {
                const totalSeconds = parseTimeToSeconds(timeStr);
                const distance = parseFloat(distanceKm);
                if (totalSeconds > 0 && distance > 0) {
                    const paceSecondsPerKm = totalSeconds / distance;
                    const paceMinutes = Math.floor(paceSecondsPerKm / 60);
                    const paceSeconds = Math.floor(paceSecondsPerKm % 60);
                    return `${String(paceMinutes).padStart(2, '0')}:${String(paceSeconds).padStart(2, '0')} /km`;
                }
                return "--:-- /km";
            }
            
            function createTable(dataToDisplay, isFullView, currentDisplayWeek) {
                const table = document.createElement('table');
                table.className = 'w-full text-sm text-left border-collapse';
                
                const thead = document.createElement('thead');
                thead.innerHTML = `
                    <tr class="border-b border-slate-300 bg-slate-100">
                        ${isFullView ? '<th class="p-3 font-semibold text-slate-700">Wk</th>' : ''}
                        <th class="p-3 font-semibold text-slate-700">Day & Date</th>
                        <th class="p-3 font-semibold text-slate-700">Workout & Log</th>
                    </tr>
                `;
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                dataToDisplay.forEach(weekData => {
                    const weekStartDate = new Date(planStartDate);
                    weekStartDate.setDate(weekStartDate.getDate() + (weekData.week - 1) * 7);

                    const daysOfWeek = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    const plannedWorkouts = [weekData.mon, weekData.tue, weekData.wed, weekData.thu, weekData.fri, weekData.sat, weekData.sun];
                    
                    let dayCounterForWeek = 0;
                    plannedWorkouts.forEach(workout => { if(workout) dayCounterForWeek++; });


                    daysOfWeek.forEach((dayName, dayIndex) => {
                        const plannedWorkout = plannedWorkouts[dayIndex];
                        if (plannedWorkout) {
                            const runId = `w${weekData.week}d${dayIndex}`;
                            const log = runLogData[runId] || { completed: false, actualTime: '', actualDistance: '', comments: '', calculatedPace: '--:-- /km' };
                            const isCurrentActualWeek = weekData.week === currentDisplayWeek;
                            const exactDateStr = getFormattedDate(weekStartDate, dayIndex);
                            
                            const row = document.createElement('tr');
                            row.className = `border-b border-slate-200 ${isCurrentActualWeek ? 'bg-teal-50' : ''} ${log.completed ? 'completed-run' : ''}`;
                            
                            let rowHTML = '';
                            if (isFullView && dayIndex === 0) {
                                const firstDayWithWorkoutIndex = plannedWorkouts.findIndex(w => w);
                                if (dayIndex === firstDayWithWorkoutIndex) {
                                     rowHTML += `<td rowspan="${dayCounterForWeek}" class="p-3 font-semibold table-cell-top text-center border-r border-slate-200">${weekData.week}</td>`;
                                }
                            }
                            rowHTML += `<td class="p-3 font-semibold text-slate-600 table-cell-top">${exactDateStr}</td>`;
                            rowHTML += `<td class="p-3 space-y-3">
                                <div class="flex items-start gap-3">
                                    <input type="checkbox" id="${runId}-completed" data-runid="${runId}" class="run-checkbox-completed h-5 w-5 mt-1 rounded border-gray-400 text-teal-600 focus:ring-teal-500 cursor-pointer" ${log.completed ? 'checked' : ''}>
                                    <label for="${runId}-completed" class="flex-1 font-medium text-slate-800 cursor-pointer">${plannedWorkout}</label>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 pl-8">
                                    <div>
                                        <label for="${runId}-time" class="block text-xs font-medium text-slate-500 mb-1">Time Ran</label>
                                        <input type="text" id="${runId}-time" data-runid="${runId}" value="${log.actualTime}" placeholder="HH:MM:SS" class="actual-time-input input-sm w-full">
                                    </div>
                                    <div>
                                        <label for="${runId}-dist" class="block text-xs font-medium text-slate-500 mb-1">Distance (km)</label>
                                        <input type="number" id="${runId}-dist" data-runid="${runId}" value="${log.actualDistance}" step="0.01" placeholder="e.g., 5.25" class="actual-distance-input input-sm w-full">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-slate-500 mb-1">Actual Pace</label>
                                        <span id="${runId}-pace" class="calculated-pace block p-1.5 text-sm ${log.calculatedPace === '--:-- /km' ? 'pace-greyed' : 'font-semibold text-slate-700'}">${log.calculatedPace || '--:-- /km'}</span>
                                    </div>
                                </div>
                                <div class="pl-8">
                                    <label for="${runId}-comments" class="block text-xs font-medium text-slate-500 mb-1">Comments</label>
                                    <textarea id="${runId}-comments" data-runid="${runId}" placeholder="How was the run? Any notes..." class="actual-comments-input input-sm w-full text-xs" rows="2">${log.comments}</textarea>
                                </div>
                            </td>`;
                            
                            row.innerHTML = rowHTML;
                            tbody.appendChild(row);
                        }
                    });

                    if (weekData.motivation || isFullView) { // Always add summary row in full view
                         const summaryAndMotivationRow = document.createElement('tr');
                         summaryAndMotivationRow.className = `border-b-2 border-slate-300 ${weekData.week === currentDisplayWeek ? 'bg-teal-50' : 'bg-slate-100'}`;
                         let smHTML = '';
                         if (isFullView) smHTML += `<td class="p-3"></td>`;
                         smHTML += `<td colspan="${isFullView ? 2 : 3}" class="p-3">
                                        <div class="text-xs weekly-summary-text mb-1" id="week-${weekData.week}-summary">Loading summary...</div>
                                        ${weekData.motivation ? `<div class="motivational-text text-center text-sm">${weekData.motivation}</div>` : ''}
                                    </td>`;
                         summaryAndMotivationRow.innerHTML = smHTML;
                         tbody.appendChild(summaryAndMotivationRow);
                         updateWeeklySummaryDisplay(weekData.week, weekData.totalKm);
                    }
                });
                table.appendChild(tbody);
                return table;
            }
            
            function updateRunDataAndUI(runId, field, value) {
                if (!runLogData[runId]) {
                    runLogData[runId] = { completed: false, actualTime: '', actualDistance: '', comments: '', calculatedPace: '--:-- /km' };
                }
                runLogData[runId][field] = value;

                if (field === 'actualTime' || field === 'actualDistance') {
                    const newPace = calculatePace(runLogData[runId].actualTime, runLogData[runId].actualDistance);
                    runLogData[runId].calculatedPace = newPace;
                    const paceEl = document.getElementById(`${runId}-pace`);
                    if (paceEl) {
                        paceEl.textContent = newPace;
                        paceEl.classList.toggle('pace-greyed', newPace === '--:-- /km');
                        paceEl.classList.toggle('font-semibold', newPace !== '--:-- /km');
                        paceEl.classList.toggle('text-slate-700', newPace !== '--:-- /km');
                    }
                }
                
                if (field === 'completed') {
                     const rowElement = document.getElementById(`${runId}-completed`).closest('tr');
                     if(rowElement) rowElement.classList.toggle('completed-run', value);
                }

                saveRunLogData();
                const weekNumber = parseInt(runId.match(/w(\d+)/)[1]);
                const weekPlan = trainingPlanData.find(w => w.week === weekNumber);
                if(weekPlan) updateWeeklySummaryDisplay(weekNumber, weekPlan.totalKm);
            }

            function attachInputListeners() {
                planContainer.querySelectorAll('.run-checkbox-completed, .actual-time-input, .actual-distance-input, .actual-comments-input').forEach(input => {
                    const eventType = input.type === 'checkbox' ? 'change' : 'blur';
                    input.addEventListener(eventType, (e) => {
                        const runId = e.target.dataset.runid;
                        let field, value;
                        if (e.target.classList.contains('run-checkbox-completed')) {
                            field = 'completed';
                            value = e.target.checked;
                        } else if (e.target.classList.contains('actual-time-input')) {
                            field = 'actualTime';
                            value = e.target.value;
                        } else if (e.target.classList.contains('actual-distance-input')) {
                            field = 'actualDistance';
                            value = e.target.value;
                        } else if (e.target.classList.contains('actual-comments-input')) {
                            field = 'comments';
                            value = e.target.value;
                        }
                        if (field) updateRunDataAndUI(runId, field, value);
                    });
                });
            }
            
            function updateWeeklySummaryDisplay(weekNumber, plannedKm) {
                let totalActualDistance = 0;
                let totalActualSeconds = 0;

                for (const runId in runLogData) {
                    if (runId.startsWith(`w${weekNumber}d`)) {
                        const log = runLogData[runId];
                        if (log.actualDistance) totalActualDistance += parseFloat(log.actualDistance) || 0;
                        if (log.actualTime) totalActualSeconds += parseTimeToSeconds(log.actualTime);
                    }
                }
                const summaryEl = document.getElementById(`week-${weekNumber}-summary`);
                if (summaryEl) {
                    summaryEl.innerHTML = `<strong>Weekly Totals:</strong> 
                        Distance: ${totalActualDistance.toFixed(2)}km / ${plannedKm}km planned. 
                        Time: ${formatSecondsToHHMMSS(totalActualSeconds)}.`;
                }
            }

            function renderPlan(isFull) {
                planContainer.innerHTML = '';
                let dataToDisplay = isFull ? trainingPlanData : [trainingPlanData.find(w => w.week === currentWeekNumberGlobal)];
                if (!dataToDisplay[0] && trainingPlanData.length > 0) dataToDisplay = [trainingPlanData[0]]; 
                
                const table = createTable(dataToDisplay, isFull, currentWeekNumberGlobal);
                planContainer.appendChild(table);
                attachInputListeners(); // Re-attach listeners after table is built
                
                // Initial update of summaries for all visible weeks
                dataToDisplay.forEach(weekData => {
                    updateWeeklySummaryDisplay(weekData.week, weekData.totalKm);
                });
            }


            viewWeekBtn.addEventListener('click', () => {
                renderPlan(false);
                planIntro.textContent = `Showing the plan for Week ${currentWeekNumberGlobal}. Log your runs!`;
                viewWeekBtn.classList.add('bg-teal-600', 'text-white');
                viewWeekBtn.classList.remove('bg-slate-200', 'text-slate-800');
                viewFullBtn.classList.add('bg-slate-200', 'text-slate-800');
                viewFullBtn.classList.remove('bg-teal-600', 'text-white');
            });

            viewFullBtn.addEventListener('click', () => {
                renderPlan(true);
                planIntro.textContent = `Showing the full 12-week plan. Current week (${currentWeekNumberGlobal}) is highlighted.`;
                viewFullBtn.classList.add('bg-teal-600', 'text-white');
                viewFullBtn.classList.remove('bg-slate-200', 'text-slate-800');
                viewWeekBtn.classList.add('bg-slate-200', 'text-slate-800');
                viewWeekBtn.classList.remove('bg-teal-600', 'text-white');
            });

            function startCountdown() {
                const interval = setInterval(() => {
                    const now = new Date().getTime();
                    const distance = raceDate - now;
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    document.getElementById("days").innerText = days < 10 ? '0' + days : days;
                    document.getElementById("hours").innerText = hours < 10 ? '0' + hours : hours;
                    document.getElementById("minutes").innerText = minutes < 10 ? '0' + minutes : minutes;
                    document.getElementById("seconds").innerText = seconds < 10 ? '0' + seconds : seconds;
                    if (distance < 0) {
                        clearInterval(interval);
                        document.getElementById("countdown").innerHTML = "<p class='text-lg font-bold text-teal-600'>Race Day has arrived! Good luck!</p>";
                    }
                }, 1000);
            }

            function renderChart() {
                const ctx = document.getElementById('mileageChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: trainingPlanData.map(w => `Wk ${w.week}`),
                        datasets: [{
                            label: 'Planned KM',
                            data: trainingPlanData.map(w => w.totalKm),
                            backgroundColor: trainingPlanData.map(w => w.week === currentWeekNumberGlobal ? 'rgba(13, 148, 136, 0.8)' : 'rgba(13, 148, 136, 0.4)'),
                            borderColor: trainingPlanData.map(w => w.week === currentWeekNumberGlobal ? 'rgba(13, 148, 136, 1)' : 'rgba(13, 148, 136, 0.6)'),
                            borderWidth: 1,
                            hoverBackgroundColor: 'rgba(13, 148, 136, 1)',
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true, title: { display: true, text: 'Kilometers' } }, x: { grid: { display: false } } },
                        plugins: { legend: { display: false }, tooltip: { callbacks: { title: (ctx) => ctx[0].label, label: (ctx) => `Planned: ${ctx.raw} km` }}}
                    }
                });
            }

            renderPlan(false);
            startCountdown();
            renderChart();
        });
    </script>
</body>
</html>
